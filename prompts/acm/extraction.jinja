# ACM Register Data Extraction

You are an expert at extracting Asbestos Containing Material (ACM) records from building inspection documents. Your task is to identify and extract structured data from ACM Register content.

## Document Context

{% if school_name %}School: {{ school_name }}{% endif %}
{% if page_number %}Current Page: {{ page_number }}{% endif %}
{% if building_context %}
Current Building Context:
- Building ID: {{ building_context.building_id or 'Not specified' }}
- Building Name: {{ building_context.building_name or 'Not specified' }}
- Room ID: {{ building_context.room_id or 'Not specified' }}
- Room Name: {{ building_context.room_name or 'Not specified' }}
- Area Type: {{ building_context.area_type or 'Interior' }}
{% endif %}

{% if chunk_info %}
Processing Chunk {{ chunk_info.chunk_index + 1 }} of {{ chunk_info.total_chunks }}
{% endif %}

## Your Extraction Task

Follow these 5 steps carefully:

### Step 1: Document Analysis
- Identify any table structures in the content (even without markdown pipe delimiters)
- Look for building headers (format: "Building A1 - Main Building" or "A1 - Main Building - 1975")
- Look for room headers (format: "Room 101 - Classroom" or "A1-R1 - Storeroom")
- Note area type sections (Interior, Exterior, Grounds)

### Step 2: Data Completeness
- Extract ALL available fields from each row or entry
- For fields that are not present in the source, use `null` (do NOT guess or invent data)
- If a value is unclear or ambiguous, set `extraction_confidence` to "low" and add a note to `data_issues`

### Step 3: Safety Assessment
- Pay special attention to:
  - Friable materials (higher risk when disturbed)
  - Poor condition materials
  - High disturbance potential areas
  - Detected/positive asbestos results
- Flag high-risk items appropriately in `risk_status`

### Step 4: Data Mapping
- Map product descriptions to standard categories when possible
- For "No Asbestos" or "NAD" entries, set result to "Not Detected"
- For "Detected" or positive results, set result to "Detected"
- For presumed ACM, set result to "Presumed"
- Building IDs typically follow format: letter + number (e.g., A1, B2, C3)
- Room IDs may include building prefix (e.g., A1-R1, A1-R2)

### Step 5: Quality Validation
- Verify each record has the REQUIRED fields: building_id, product, material_description, result
- Records without building_id should use context from previous entries or "Unknown"
- Add data_issues entries for any extraction concerns:
  - Missing required fields
  - Ambiguous values
  - Inconsistent data
  - Context uncertainty

## Extraction Confidence Guidelines

Set `extraction_confidence` based on these criteria:

**high** - Use when:
- All required fields are clearly present
- Data is unambiguous
- Source text has clear structure

**medium** - Use when:
- Most fields present but some gaps
- Some values required interpretation
- Context was inferred from surrounding text

**low** - Use when:
- Significant data gaps
- Values are unclear or ambiguous
- Heavy reliance on context inference

## Handling Special Cases

### No ACM Data Found
If the content has no ACM records (e.g., cover page, table of contents, appendix):
- Return an empty `records` array
- This is valid - not an error

### "No Asbestos" Entries
Some tables show products tested negative for asbestos:
- Extract these as records with `result: "Not Detected"`
- They are still valid ACM Register entries

### Building/Room Context Continuity
- If a record doesn't specify a building/room, use the most recent context
- Add a data_issue: "Building/room context inferred from previous entries"

## Content to Extract

```
{{ content }}
```

## Output Format

Return your extraction as a JSON object matching the ACMExtractionResult schema with:
- `records`: Array of extracted ACM records
- `status`: "valid" if extraction succeeded, "no_acm_data" if content has no ACM data
- `extraction_notes`: Any important observations about the extraction

Each record in the `records` array must have these REQUIRED fields:
- `building_id`: Building identifier (string)
- `product`: Product type (string)
- `material_description`: Material description (string)
- `result`: Test result (string: "Detected", "Not Detected", "Presumed", or "Unknown")
- `extraction_confidence`: Confidence level (string: "high", "medium", "low")

All other fields are optional - use `null` if not available.
